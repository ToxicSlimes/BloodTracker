# 🏰 BloodTracker — Dungeon UI Rebuild
## Техническое задание v1.1

---

## 1. КОНЦЕПЦИЯ

BloodTracker получает новый UI в стилистике **подземелья (dungeon crawler)** от первого лица.
Пользователь стоит в центре главного зала и видит перед собой коридор с дверями.
На каждой двери — вывеска с названием раздела. Клик по вывеске запускает анимацию
движения камеры к двери, дверь открывается, и на экране появляется контент раздела,
оформленный в стилистике соответствующей комнаты.

**Ключевые принципы:**
- Вид от первого лица (pseudo-3D через CSS perspective)
- Навигация = перемещение по подземелью
- Каждый раздел = уникальная комната со своим интерьером
- Все переходы анимированы (камера движется, дверь открывается)
- Стены из кирпичей с процедурными трещинами, потёртостями, дырами
- Текущая CRT/ASCII эстетика сохраняется как overlay-эффекты
- Факелы на стенах по всему подземелью (уже есть в текущем UI)

**Целевая платформа:** Desktop web (Chrome, Firefox, Safari). Мобилка — упрощённая версия.

---

## 2. КАРТА ПОДЗЕМЕЛЬЯ (TOP-DOWN)

```
                    ┌─────────────┐
                    │   АДМИН     │
                    │  (скрыта)   │
                    └──────┬──────┘
                           │ потайная дверь
    ┌──────────┐   ┌───────┴───────┐   ┌──────────┐
    │ТРЕНИРОВКИ│   │               │   │ ASCII    │
    │  Зал с   ├───┤  ГЛАВНЫЙ ЗАЛ ├───┤ СТУДИЯ   │
    │ цепями   │   │               │   │ Мастерская│
    └──────────┘   │   (вид от 1   │   └──────────┘
                   │    лица)      │
    ┌──────────┐   │               │   ┌──────────┐
    │ЭНЦИКЛО-  ├───┤   Факелы на   ├───┤СРАВНЕНИЕ │
    │ПЕДИЯ     │   │   стенах      │   │ Зеркальный│
    │ Библио-  │   │               │   │ зал      │
    │ тека     │   └───────┬───────┘   └──────────┘
    └──────────┘           │
                   ┌───────┴───────┐
    ┌──────────┐   │               │   ┌──────────┐
    │ КУРС     ├───┤   КОРИДОР     ├───┤ АНАЛИЗЫ  │
    │ Алхими-  │   │               │   │ Лабора-  │
    │ ческая   │   └───────┬───────┘   │ тория    │
    └──────────┘           │           └──────────┘
                    ┌──────┴──────┐
                    │  ДАШБОРД    │
                    │  Тронный    │
                    │  зал        │
                    └─────────────┘
```

---

## 3. ГЛАВНЫЙ ЗАЛ — ВИД ОТ ПЕРВОГО ЛИЦА

Это основной экран, который видит пользователь после логина. Вид от первого лица
в центре каменного коридора. Впереди — стена с дверями, по бокам тоже двери.

### 3.1 Схема вида от первого лица (что видит игрок)

```
┌─────────────────────────────────────────────────────────────────┐
│░░░░░░░░░░░░░░░░░░░░░░░░░░░ПОТОЛОК░░░░░░░░░░░░░░░░░░░░░░░░░░░░░│
│░░░░░░░░░░░░░░░░░░░░(тёмный каменный свод)░░░░░░░░░░░░░░░░░░░░░│
│▓▓▓▓▓▓▓▓▓┌───────────────────────────────────────┐▓▓▓▓▓▓▓▓▓▓▓▓▓│
│▓СТЕНА▓▓▓│                                       │▓▓▓СТЕНА▓▓▓▓▓│
│▓ лев. ▓▓│          ДАЛЬНЯЯ СТЕНА                │▓▓▓правая▓▓▓▓│
│▓▓▓▓▓▓▓▓▓│                                       │▓▓▓▓▓▓▓▓▓▓▓▓│
│▓ 🔥    ▓│  ┌─────┐   ┌─────┐   ┌─────┐         │▓    🔥 ▓▓▓▓│
│▓факел  ▓│  │ДВЕРЬ│   │ДВЕРЬ│   │ДВЕРЬ│         │▓  факел▓▓▓▓│
│▓▓▓▓▓▓▓▓▓│  │  1  │   │  2  │   │  3  │         │▓▓▓▓▓▓▓▓▓▓▓▓│
│▓┌────┐▓▓│  └──┬──┘   └──┬──┘   └──┬──┘         │▓▓┌────┐▓▓▓▓│
│▓│ДВЕРЬ│▓│     │         │         │             │▓▓│ДВЕРЬ│▓▓▓│
│▓│ лев│▓▓│  [ВЫВЕСКА] [ВЫВЕСКА] [ВЫВЕСКА]       │▓▓│прав│▓▓▓▓│
│▓└────┘▓▓│  ДАШБОРД   АНАЛИЗЫ    КУРС           │▓▓└────┘▓▓▓▓│
│▓▓▓▓▓▓▓▓▓│                                       │▓▓▓▓▓▓▓▓▓▓▓▓│
│▓▓▓▓▓▓▓▓▓└───────────────────────────────────────┘▓▓▓▓▓▓▓▓▓▓▓▓│
│▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│
│▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ПОЛ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│
│▒▒▒▒▒▒▒▒▒▒▒▒▒▒(каменные плиты)▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 CSS Perspective — Как реализовать

```
  Экран (viewport)
  ┌──────────────────────────────────┐
  │          Потолок (top face)       │
  │    ╔═══════════════════════╗      │
  │    ║                       ║      │  ← perspective: 800px
  │    ║  Дальняя стена        ║      │  ← transform-style: preserve-3d
  │ Л  ║  (back wall)          ║  П   │
  │ Е  ║  ┌───┐  ┌───┐  ┌───┐ ║  Р   │
  │ В  ║  │ D │  │ D │  │ D │ ║  А   │
  │ А  ║  │ 1 │  │ 2 │  │ 3 │ ║  В   │
  │ Я  ║  └───┘  └───┘  └───┘ ║  А   │
  │    ║                       ║  Я   │
  │ С  ╚═══════════════════════╝      │
  │ Т          Пол (floor)        С   │
  │ Е                             Т   │
  │ Н                             Е   │
  │ А                             Н   │
  │                               А   │
  └──────────────────────────────────┘

  CSS-структура:

  .dungeon-viewport {
    perspective: 800px;
    perspective-origin: 50% 50%;
  }

  .dungeon-hall {
    transform-style: preserve-3d;
  }

  .wall-back   { transform: translateZ(-400px); }
  .wall-left   { transform: rotateY(90deg) translateZ(-50%); }
  .wall-right  { transform: rotateY(-90deg) translateZ(-50%); }
  .floor       { transform: rotateX(90deg) translateZ(50%); }
  .ceiling     { transform: rotateX(-90deg) translateZ(50%); }
```

### 3.3 Расположение дверей и вывесок

Двери расположены по трём видимым стенам. Дальняя стена — главные 3 двери,
боковые стены — по 1–2 двери, видны в перспективе.

```
                    ДАЛЬНЯЯ СТЕНА (видна прямо)
    ┌───────────────────────────────────────────────┐
    │                                               │
    │   ┏━━━━━━━┓     ┏━━━━━━━┓     ┏━━━━━━━┓     │
    │   ┃╔═════╗┃     ┃╔═════╗┃     ┃╔═════╗┃     │
    │   ┃║ДАSH-║┃     ┃║АНАЛИ║┃     ┃║КУРС ║┃     │
    │   ┃║БОРД ║┃     ┃║ЗЫ   ║┃     ┃║     ║┃     │
    │   ┃╚═════╝┃     ┃╚═════╝┃     ┃╚═════╝┃     │
    │   ┃ ┌───┐ ┃     ┃ ┌───┐ ┃     ┃ ┌───┐ ┃     │
    │   ┃ │ ○ │ ┃     ┃ │ ○ │ ┃     ┃ │ ○ │ ┃     │  ← кольца-ручки
    │   ┃ └───┘ ┃     ┃ └───┘ ┃     ┃ └───┘ ┃     │
    │   ┃       ┃     ┃       ┃     ┃       ┃     │
    │   ┗━━━━━━━┛     ┗━━━━━━━┛     ┗━━━━━━━┛     │
    │                                               │
    └───────────────────────────────────────────────┘

  Вывеска — это деревянная/металлическая табличка НАД дверью.
  При hover вывеска подсвечивается (glow эффект текущего цвета темы).
  При hover на дверь — факелы рядом разгораются ярче.
```

---

## 4. АНИМАЦИЯ ПЕРЕХОДА В КОМНАТУ

### 4.1 Пайплайн анимации (таймлайн)

```
  Время →
  0ms                 300ms              600ms              900ms
  │                    │                  │                  │
  ├────────────────────┼──────────────────┼──────────────────┤
  │   ФАЗА 1:          │   ФАЗА 2:        │   ФАЗА 3:       │
  │   Камера            │   Дверь           │   Контент       │
  │   приближается      │   открывается     │   появляется    │
  │   к двери           │   (swing/fade)    │   (fade-in)     │
  │                    │                  │                  │
  ├─ translateZ()──────┼─ rotateY() ──────┼─ opacity: 1 ────┤
  │  scale() up         │  дверь уходит    │  комната         │
  │  周围 blur           │  в сторону       │  рендерится      │
  │                    │  тьма за ней     │                  │

  CSS keyframes:

  @keyframes enter-room {
    0%   { transform: translateZ(0);     filter: none; }
    40%  { transform: translateZ(-300px); filter: blur(2px); }
    60%  { transform: translateZ(-380px); opacity: 0.3; }
    100% { transform: translateZ(-400px); opacity: 0; }
  }

  Следом — fade-in контента комнаты.
```

### 4.2 Анимация двери

```
  ЗАКРЫТА                  ОТКРЫВАЕТСЯ                ОТКРЫТА
  ┏━━━━━━━━┓              ┏━━━━━━━━┓                     ┃
  ┃        ┃              ┃      ╱                        ┃
  ┃  ┌──┐  ┃    →→→       ┃    ╱          →→→             ┃  (дверь
  ┃  │○ │  ┃              ┃  ╱                            ┃   ушла
  ┃  └──┘  ┃              ┃╱                              ┃   за стену)
  ┃        ┃              ╱                               ┃
  ┗━━━━━━━━┛              ┗━━━━━━━━━━━                    ┃

  CSS: transform: rotateY(-90deg); transform-origin: left;
  Transition: 0.4s ease-in-out
```

### 4.3 Обратный переход (выход из комнаты)

Кнопка «НАЗАД» или ESC → обратная анимация:
контент fade-out → дверь закрывается → камера отъезжает назад в зал.

```
  В комнате:
  ┌──────────────────────────────┐
  │                              │
  │    Контент комнаты...        │
  │                              │
  │         [ ← НАЗАД ]          │   ← Кнопка в углу (стилизована
  │                              │      как "выход из комнаты")
  └──────────────────────────────┘
                 │
                 ▼
  Анимация: камера отъезжает → снова видим коридор
```

---

## 5. КОМНАТЫ — ДИЗАЙН ИНТЕРЬЕРОВ

### 5.1 🏆 ДАШБОРД — Тронный зал

**Атмосфера:** Большой зал, по центру — трон (дашборд юзера).
По бокам — знамёна с показателями. Факелы горят ярко.

```
  ┌──────────────────────────────────────────┐
  │       🔥                        🔥       │
  │     факел    ╔══════════╗     факел      │
  │              ║  ТРОН    ║                 │
  │    ┌────┐    ║ (аватар  ║    ┌────┐      │
  │    │ЗНАМЯ│   ║  юзера)  ║    │ЗНАМЯ│     │
  │    │День │    ╚══════════╝    │Анализ│    │
  │    │курса│                   │ов    │    │
  │    │ 14  │    ┌──────────┐   │ 3    │    │
  │    └────┘    │ БЫСТРЫЕ  │   └────┘      │
  │              │ ДЕЙСТВИЯ │                │
  │              └──────────┘                │
  │                                          │
  │    ┌─────────────────────────────┐       │
  │    │ ПРЕПАРАТЫ КУРСА             │       │
  │    │ (карточки как свитки        │       │
  │    │  на столе перед троном)     │       │
  │    └─────────────────────────────┘       │
  │                                          │
  │    ┌─────────────────────────────┐       │
  │    │ ⚠ ПОКАЗАТЕЛИ, ТРЕБУЮЩИЕ    │       │
  │    │   ВНИМАНИЯ (свечение        │       │
  │    │   красным при проблемах)    │       │
  │    └─────────────────────────────┘       │
  └──────────────────────────────────────────┘

  Элементы дизайна:
  - Stat-карточки = знамёна/баннеры на стенах
  - Быстрые действия = кнопки на каменном столе
  - Alerts = свитки с красной печатью
```

### 5.2 🧪 АНАЛИЗЫ — Лаборатория алхимика

**Атмосфера:** Каменная комната с полками, на них колбы и реторты.
Стол с разложенными пергаментами (анализы). Зелёное/голубое свечение.

```
  ┌──────────────────────────────────────────┐
  │  ┌─ ПОЛКИ С КОЛБАМИ ────────────────┐    │
  │  │  🧪  🧫  ⚗️  🧪  🧫  ⚗️  🧪    │    │
  │  │  Тест.  ЛГ  ФСГ  Прол Эстр ГСПГ │    │
  │  └──────────────────────────────────┘    │
  │                                          │
  │  ┌─ РАБОЧИЙ СТОЛ ──────────────────┐    │
  │  │  ╔══════════════════════════╗    │    │
  │  │  ║ Выбранный анализ:        ║    │    │
  │  │  ║ [dropdown — как свиток]  ║    │    │
  │  │  ╚══════════════════════════╝    │    │
  │  │                                  │    │
  │  │  Таблица результатов             │    │
  │  │  (пергамент с данными)           │    │
  │  │  ┌────────┬────────┬────────┐    │    │
  │  │  │Показат.│Значение│ Норма  │    │    │
  │  │  ├────────┼────────┼────────┤    │    │
  │  │  │🟢 Тест│ 25.4   │8.3-30.1│    │    │
  │  │  │🔴 ЛГ  │ 0.1    │0.6-12  │    │    │
  │  │  └────────┴────────┴────────┘    │    │
  │  └──────────────────────────────────┘    │
  │                                          │
  │  ┌─ ТРЕНД (график на стене) ───────┐    │
  │  │  ~~~~/\~~~~~/\~~~~                │    │
  │  │           \/ (нарисован           │    │
  │  │              "мелом на стене")     │    │
  │  └──────────────────────────────────┘    │
  └──────────────────────────────────────────┘

  Элементы дизайна:
  - Анализы = пергаменты / свитки
  - Таблица результатов = вырезано на камне / написано чернилами
  - Тренд-графики = нарисованы "мелом" на стене (стилизация)
  - Индикаторы нормы = цветные зелья в колбах
  - Импорт PDF = "бросить свиток в котёл"
```

### 5.3 ⚗️ КУРС — Алхимическая лаборатория

**Атмосфера:** Мастерская алхимика. Котёл по центру. На полках —
банки с препаратами. Рецепты на стенах.

```
  ┌──────────────────────────────────────────┐
  │                                          │
  │  ТАБЫ (каменные таблички на стене):       │
  │  ┌──────────┬──────────┬────────┬──────┐ │
  │  │ПРЕПАРАТЫ │ ЛОГИ     │РЕЕСТР  │СТАТ. │ │
  │  │(активный)│ ПРИЁМА   │        │      │ │
  │  └──────────┴──────────┴────────┴──────┘ │
  │                                          │
  │     ┌──────────────────────────┐         │
  │     │    ⚗️  КОТЁЛ             │         │
  │     │   ╔══════════════╗       │         │
  │     │   ║ Название:    ║       │         │
  │     │   ║ Первый курс  ║       │         │
  │     │   ║ 01.01-01.04  ║       │         │
  │     │   ╚══════════════╝       │         │
  │     └──────────────────────────┘         │
  │                                          │
  │  ┌─ ПОЛКИ С ПРЕПАРАТАМИ ───────────┐     │
  │  │  ┌──────┐ ┌──────┐ ┌──────┐    │     │
  │  │  │ Тест │ │ Мест │ │ ХГЧ  │    │     │
  │  │  │ Энант│ │      │ │      │    │     │
  │  │  │250мг │ │ 25мг │ │5000МЕ│    │     │
  │  │  └──────┘ └──────┘ └──────┘    │     │
  │  │  (клик → детали препарата)      │     │
  │  └─────────────────────────────────┘     │
  └──────────────────────────────────────────┘

  Элементы дизайна:
  - Табы курса = каменные таблички / переключатели на стене
  - Препараты = банки / пузырьки на полках
  - Лог приёма = книга записей (открытая тетрадь)
  - Реестр = шкаф с ящичками
  - Статистика = большая карта/схема на стене
```

### 5.4 ⚖️ СРАВНЕНИЕ — Зеркальный зал

**Атмосфера:** Комната с двумя большими зеркалами друг напротив друга.
В каждом зеркале отражается один анализ. Между ними — стол сравнения.

```
  ┌──────────────────────────────────────────┐
  │                                          │
  │  ┌── ЗЕРКАЛО 1 ──┐  ┌── ЗЕРКАЛО 2 ──┐  │
  │  │                │  │                │  │
  │  │  Анализ ДО     │  │  Анализ ПОСЛЕ  │  │
  │  │  [dropdown]    │  │  [dropdown]    │  │
  │  │                │  │                │  │
  │  │  Тест: 8.5     │  │  Тест: 28.4   │  │
  │  │  ЛГ:   5.2     │  │  ЛГ:   0.1    │  │
  │  │                │  │                │  │
  │  └────────────────┘  └────────────────┘  │
  │                                          │
  │          ┌── СТОЛ СРАВНЕНИЯ ──┐          │
  │          │ Показатель │ Δ     │          │
  │          │ Тест       │ ↑+235%│          │
  │          │ ЛГ         │ ↓-98% │          │
  │          └────────────────────┘          │
  └──────────────────────────────────────────┘

  Элементы дизайна:
  - Два зеркала = два анализа для сравнения
  - Дельта-значения = "магические руны" между зеркалами
  - Позитивные изменения = зелёное свечение
  - Негативные изменения = красное свечение
```

### 5.5 🏋️ ТРЕНИРОВКИ — Зал с цепями

**Атмосфера:** Тренировочный зал подземелья. Цепи на стенах,
каменные стойки для весов. Щиты с программами на стенах.

```
  ┌──────────────────────────────────────────┐
  │  ⛓️                               ⛓️    │
  │                                          │
  │  ┌─ЩИТЫ──┐ ┌─ДНИ──┐ ┌─УПРАЖ─┐ ┌─ПОДХ─┐│
  │  │Програм│ │Пон   │ │Жим    │ │12x60 ││
  │  │мы:    │→│Вт    │→│лёжа   │→│10x70 ││
  │  │       │ │Ср    │ │Присед │ │8x80  ││
  │  │Набор  │ │...   │ │       │ │      ││
  │  │массы  │ │      │ │       │ │      ││
  │  └───────┘ └──────┘ └───────┘ └──────┘│
  │                                          │
  │  ┌── ASCII МУСКУЛАТУРА ───────────┐      │
  │  │      .─────.                   │      │
  │  │     /  ◉ ◉  \                  │      │
  │  │    │ ╔═════╗ │    ← Подсветка  │      │
  │  │   ╔╝ ║ГРУДЬ║ ╚╗     активной  │      │
  │  │   ║  ╚═════╝  ║     группы    │      │
  │  │   ║   │   │   ║     мышц      │      │
  │  │   ╚═══╧═══╧═══╝               │      │
  │  └────────────────────────────────┘      │
  └──────────────────────────────────────────┘

  Элементы дизайна:
  - Панели программ = щиты на стене
  - Навигация drill-down = цепочка щитов слева→направо
  - ASCII мускулатура сохраняется как есть
  - Подходы = зарубки на камне
```

### 5.6 📚 ЭНЦИКЛОПЕДИЯ — Библиотека подземелья

**Атмосфера:** Огромная библиотека с высокими стеллажами до потолка.
На полках стоят книги (препараты). Лестницы для доступа к верхним полкам.

```
  ┌──────────────────────────────────────────┐
  │                 🔥                        │
  │  ┌─ ПОИСК (свиток с лупой) ──────────┐   │
  │  │  🔍 [________________________]     │   │
  │  └────────────────────────────────────┘   │
  │                                          │
  │  ТАБЫ КАТЕГОРИЙ (закладки на полке):      │
  │  [ВСЕ] [ААС] [ПЕПТИДЫ] [ПКТ] [САРМ]    │
  │                                          │
  │  ┌─ СТЕЛЛАЖ ─────────────────────────┐   │
  │  │                                    │   │
  │  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │   │
  │  │  │ 📕  │ │ 📗  │ │ 📘  │ │ 📙  │ │   │
  │  │  │Тест.│ │Нанд.│ │Болд.│ │Трен.│ │   │
  │  │  │Энант│ │Дека │ │     │ │Ацет │ │   │
  │  │  └──┬──┘ └──┬──┘ └──┬──┘ └──┬──┘ │   │
  │  │     ↓ клик  ↓       ↓       ↓     │   │
  │  │  Книга раскрывается → модалка      │   │
  │  │  с детальной информацией           │   │
  │  │                                    │   │
  │  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │   │
  │  │  │ 📕  │ │ 📗  │ │ 📘  │ │ 📙  │ │   │
  │  │  │ГР   │ │ХГЧ  │ │Кломи│ │Таксо│ │   │
  │  │  └─────┘ └─────┘ └─────┘ └─────┘ │   │
  │  │                                    │   │
  │  └────────────────────────────────────┘   │
  │                                          │
  │  ┌─ ПРОИЗВОДИТЕЛИ (витрина) ─────────┐   │
  │  │  [ФАРМА]  [UGL]  [ВСЕ]           │   │
  │  │  ┌─────┐ ┌─────┐ ┌─────┐         │   │
  │  │  │Балкан│ │Фарм.│ │Magn.│         │   │
  │  │  └─────┘ └─────┘ └─────┘         │   │
  │  └────────────────────────────────────┘   │
  └──────────────────────────────────────────┘

  Элементы дизайна:
  - Препараты = книги/тома на полках
  - Каждая категория = отдельная полка (ряд)
  - Hover на книгу = она чуть выдвигается из полки
  - Клик = книга "раскрывается" → анимация → модалка с деталями
  - Поиск = свиток с лупой наверху
  - Производители = витрина внизу с гербами/печатями
```

### 5.7 🎨 ASCII СТУДИЯ — Мастерская

**Атмосфера:** Мастерская художника/гравёра. Мольберт по центру,
инструменты на стенах.

```
  ┌──────────────────────────────────────────┐
  │                                          │
  │     🔥              🔥                   │
  │                                          │
  │  ┌── МОЛЬБЕРТ ─────────────────────┐     │
  │  │                                  │     │
  │  │   ASCII Art Canvas               │     │
  │  │   (текущий функционал)           │     │
  │  │                                  │     │
  │  └──────────────────────────────────┘     │
  │                                          │
  │  ┌─ Инструменты (на верстаке) ─────┐     │
  │  │  [Кисть] [Ластик] [Текст] [...]  │     │
  │  └──────────────────────────────────┘     │
  └──────────────────────────────────────────┘
```

---

## 6. ПРОЦЕДУРНЫЕ КИРПИЧНЫЕ СТЕНЫ

### 6.1 Генерация текстур кирпичей

Стены подземелья — это CSS-generated кирпичная кладка с процедурными дефектами.

```
  БАЗОВЫЙ КИРПИЧ (repeating unit):
  ┌──────────┬──────────┬──────────┐
  │██████████│██████████│██████████│  ← Ряд 1
  ├─────┬────┴────┬─────┴────┬─────┤
  │█████│█████████│██████████│█████│  ← Ряд 2 (смещение 50%)
  ├─────┴────┬────┴────┬─────┴─────┤
  │██████████│██████████│██████████│  ← Ряд 3
  └──────────┴──────────┴──────────┘

  С ДЕФЕКТАМИ (процедурно):
  ┌──────────┬──────────┬──────────┐
  │██████████│████░░████│██████████│  ← трещина
  ├─────┬────┴────┬─────┴────┬─────┤
  │█████│█████████│     ╳    │█████│  ← выбитый кирпич (дыра)
  ├─────┴────┬────┴────┬─────┴─────┤
  │██▒▒▒▒████│██████████│██████████│  ← потёртость
  ├──────────┼──────────┼──────────┤
  │██████████│████      │██████████│  ← отсутствующий кирпич
  │          │    ┌──┐  │          │
  │██████████│    │░░│  │██████████│  ← окно с решёткой!
  │          │    │░░│  │          │
  │██████████│    └──┘  │██████████│
  └──────────┴──────────┴──────────┘
```

### 6.2 Типы дефектов (CSS + SVG)

```
  Тип             │ Реализация                │ Частота
  ────────────────┼───────────────────────────┼──────────
  Трещины         │ SVG path с random points  │ 15-20%
  Потёртости      │ CSS gradient overlay      │ 30-40%
  Выбитые кирпичи │ transparent hole + shadow │ 5-8%
  Мох / плесень   │ Green/dark CSS gradient   │ 10-15%
  Влажные пятна   │ Darker shade + subtle     │ 20%
                  │ CSS animation (shimmer)   │
  ────────────────┼───────────────────────────┼──────────
  Окна с решёткой │ CSS grid + bars           │ 1-2 на стену
  Дыры (прострелы)│ border-radius: 50%        │ 3-5%
                  │ + inner shadow            │
```

### 6.3 Окна с решётками

```
  ┌────────────────┐
  │  ║  ║  ║  ║    │   ← Вертикальные прутья
  │──╫──╫──╫──╫────│   ← Горизонтальная перемычка
  │  ║░░║░░║░░║    │   ← За решёткой — синеватый свет
  │──╫──╫──╫──╫────│      (moonlight glow)
  │  ║░░║░░║░░║    │
  │──╫──╫──╫──╫────│
  │  ║  ║  ║  ║    │
  └────────────────┘

  CSS:
  .window-bars {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    background: radial-gradient(ellipse, #1a2a3a, #000);
  }
  .window-bars::before { /* горизонтальные прутья */ }
  .window-bars .bar { /* вертикальные прутья */ }
```

---

## 6A. UNICODE-СИМВОЛЫ ДЛЯ ВЫСОКОПЛОТНОЙ ASCII ГРАФИКИ

Традиционный ASCII (95 печатных символов) сильно ограничивает визуальную плотность.
Современный Unicode открывает три диапазона символов, которые кардинально повышают
разрешение и выразительность — и именно их мы используем для стен, UI-рамок,
освещения и миникарты подземелья.

### 6A.1 Half-block элементы (U+2580–U+2590) — ОСНОВА

Это самая важная техника. Верхний полублок `▀` и нижний полублок `▄` заполняют
ровно половину ячейки символа. Установив foreground-цвет для одной половины
и background для другой, каждая ячейка отображает **два независимо окрашенных пикселя**,
удваивая вертикальное разрешение.

```
  Обычный символ:          Half-block символ:
  ┌──────────┐              ┌──────────┐
  │          │              │▓▓▓▓▓▓▓▓▓▓│ ← foreground color
  │  1 цвет  │      →       ├──────────┤
  │          │              │░░░░░░░░░░│ ← background color
  └──────────┘              └──────────┘
  1 пиксель на ячейку       2 пикселя на ячейку

  Сетка 80×50 символов → 80×100 эффективных пикселей
  Достаточно для детальных карт подземелья с плавными градиентами.
```

**Shade-символы** `░▒▓█` дают 4 уровня плотности заливки (25%, 50%, 75%, 100%).
Идеальны для fog-of-war, затухания освещения и атмосферной глубины:

```
  Факел →  █▓▒░·   ·░▒▓█ ← Факел
           ^^^^^
           Градиент освещения от яркого к темноте

  Применение в подземелье:
  - █ = полностью освещённая стена рядом с факелом
  - ▓ = средняя освещённость (2-3 клетки от факела)
  - ▒ = полутень (4-5 клеток)
  - ░ = едва видно (дальний край коридора)
  - · = кромешная тьма (fog-of-war)
```

**Quadrant-символы** (U+2596–U+259F) кодируют 2×2 субпиксельную сетку на ячейку —
16 комбинаций четвертей блока, ограничены двумя цветами на ячейку.
Полезны для сглаженных диагональных стен и закруглений.

### 6A.2 Box-drawing символы (U+2500–U+257F) — UI-КАРКАС

Структурный словарь для UI-панелей, диалоговых окон и архитектуры подземелья:

```
  Одинарные:  ─ │ ┌ ┐ └ ┘ ├ ┤ ┬ ┴ ┼
  Двойные:    ═ ║ ╔ ╗ ╚ ╝ ╠ ╣ ╦ ╩ ╬
  Тяжёлые:    ━ ┃ ┏ ┓ ┗ ┛
  Скруглённые: ╭ ╮ ╰ ╯

  Пример рамки вывески:
  ╔══════════════╗
  ║  ДАШБОРД     ║
  ╚══════════════╝

  Пример рамки комнаты:
  ╭──────────────────╮
  │  Тронный зал     │
  ╰──────────────────╯
```

**Важный нюанс** (из практики Will McGugan, создатель Rich/Textual):
Традиционные box-drawing символы **пропускают фоновый цвет** в зазоре между
линией и краем ячейки. Решение — использовать 1/8 блочные элементы вместо них:
`▏` (лево), `▕` (право), `▔` (верх), `▁` (низ) — они дают точный контроль
над fg/bg цветами на границе, устраняя "протечку" фона.

### 6A.3 Braille-паттерны (U+2800–U+28FF) — МИНИКАРТА

Каждый braille-символ кодирует **2×4 точечную сетку** — 8 независимо
переключаемых субпикселей на ячейку. 256 символов = все комбинации 8 точек.
Формула: `codepoint = 0x2800 + bitmask`.

```
  Одна ячейка braille:      Миникарта подземелья (пример):
  ┌───┐                      ⠀⠀⣀⣤⣤⣀⠀⠀
  │⠁⠈│ ← точки 1,4          ⠀⣴⣿⣿⣿⣿⣦⠀
  │⠂⠐│ ← точки 2,5          ⣾⣿⠃⠀⠀⠘⣿⣷
  │⠄⠠│ ← точки 3,6          ⣿⣿⠀⠀⠀⠀⣿⣿
  │⡀⢀│ ← точки 7,8          ⠻⣿⣦⣀⣀⣴⣿⠟
  └───┘                      ⠀⠀⠙⠻⠿⠟⠋⠀⠀

  Сетка 40×12 символов → 80×48 монохромных пикселей
  Идеально для миникарты подземелья в углу экрана.
```

### 6A.4 Оптимальная послойная схема для нашего подземелья

```
  Слой         │ Символы                  │ Назначение
  ─────────────┼──────────────────────────┼─────────────────────
  Стены/пол    │ ▀▄ █▓▒░ (half-blocks +   │ Основная геометрия
               │ shade characters)         │ с градиентами
  ─────────────┼──────────────────────────┼─────────────────────
  UI рамки     │ ╔═║╗╚╝ или ▏▕▔▁         │ Панели, вывески,
               │ (box-drawing / 1/8 blocks)│ диалоги
  ─────────────┼──────────────────────────┼─────────────────────
  Сущности     │ @ ☠ ♦ A-Z               │ Игрок, элементы,
               │ (стандартный ASCII)       │ интерактивные объекты
  ─────────────┼──────────────────────────┼─────────────────────
  Освещение    │ ░▒▓ (shade characters)   │ Fog-of-war, затухание
               │                          │ света от факелов
  ─────────────┼──────────────────────────┼─────────────────────
  Миникарта    │ ⠁⠂⠄⡀ (braille patterns) │ Обзорная карта
               │                          │ подземелья
  ─────────────┼──────────────────────────┼─────────────────────
```

---

## 6B. АРХИТЕКТУРА РЕНДЕРИНГА (ANSI CELL BUFFER)

Вдохновлено подходом asciicker.com — настоящего текстового 3D-движка,
который вычисляет всю 3D-сцену на уровне символьных ячеек (не пикселей),
выдавая на выход 2D-сетку `AnsiCell` структур.

### 6B.1 Паттерн ANSI Cell Buffer

Все визуальные данные проходят через единый промежуточный буфер —
это развязывает игровую логику от рендеринга.

```typescript
  // Одна ячейка экрана
  interface AnsiCell {
    glyph: string;       // символ (Unicode codepoint)
    fg: string;          // foreground цвет (#rrggbb)
    bg: string;          // background цвет (#rrggbb)
    dirty: boolean;      // изменилась ли с прошлого кадра
  }

  // Двойная буферизация
  class AnsiBuffer {
    width: number;       // ширина в ячейках (напр. 80)
    height: number;      // высота в ячейках (напр. 50)
    current: AnsiCell[][];   // текущий кадр
    previous: AnsiCell[][];  // предыдущий кадр (для diff)

    // Записать ячейку
    set(x: number, y: number, glyph: string, fg: string, bg: string): void;

    // Получить список изменённых ячеек (dirty rectangles)
    getDirty(): Array<{x: number, y: number, cell: AnsiCell}>;

    // Зафиксировать кадр (current → previous)
    commit(): void;
  }
```

**Ключевой инсайт из asciicker:** вычисления на уровне символьных ячеек
(~4000 ячеек для 80×50 сетки) на порядки дешевле пиксельных (~2 млн для 1920×1080).
Это даёт плавную производительность даже для сложных сцен.

### 6B.2 Dirty-Rectangle рендеринг

При каждом кадре обновляем только изменившиеся ячейки, а не весь экран.

```
  Кадр N:                    Кадр N+1:
  ┌──────────────────┐       ┌──────────────────┐
  │ A B C D E F G H  │       │ A B C D E F G H  │
  │ I J K L M N O P  │  →    │ I J K L M N O P  │
  │ Q R S T U V W X  │       │ Q R S ▓ U V W X  │  ← T→▓ изменился
  │ Y Z . . . . . .  │       │ Y Z . . . . @ .  │  ← @ появился
  └──────────────────┘       └──────────────────┘

  getDirty() вернёт только 2 ячейки → обновляем 2 <span>, не 160.
  Для статичных сцен (стоим в зале) — 0 обновлений = 0 нагрузки на DOM.
```

### 6B.3 Гибридный рендеринг: DOM + Canvas

```
  ┌─────────────────────────────────────────────┐
  │  DOM-слой (основной)                         │
  │  <pre> с <span> для цветных символьных runs  │
  │  + CSS perspective для 3D эффектов           │
  │  + CSS transitions для анимаций              │
  │  + Native hover/click на элементах           │
  │                                              │
  │  Когда использовать:                         │
  │  - Стены, двери, вывески, UI-панели          │
  │  - Всё, что нужно кликать или ховерить       │
  │  - Анимации переходов между комнатами        │
  ├──────────────────────────────────────────────┤
  │  Canvas-слой (overlay, для быстрых обновлений)│
  │  ctx.fillText() + ctx.fillRect()             │
  │                                              │
  │  Когда использовать:                         │
  │  - Миникарта (braille-символы, 30+ FPS)      │
  │  - Частицы пыли / искры от факелов           │
  │  - Анимация жидкости в колбах                │
  │  - Любые элементы с >15 FPS обновлениями     │
  └─────────────────────────────────────────────┘

  Оба слоя абсолютно позиционированы друг над другом.
  Canvas pointer-events: none → клики проходят на DOM.
```

---

## 6C. ШРИФТ И НАСТРОЙКА РЕНДЕРИНГА

Криспый (чёткий) рендеринг ASCII-символов — фундамент визуального качества.
Настройки ниже гарантируют, что half-blocks, box-drawing и braille
отображаются без зазоров и артефактов.

### 6C.1 Выбор шрифта

**JetBrains Mono** — лучший шрифт для box-drawing и block-символов
на разных line-height. Резервные: Fira Code, Source Code Pro.

```css
  .dungeon-ascii {
    font-family: 'JetBrains Mono', 'Fira Code', 'Source Code Pro', monospace;
    font-size: 14px;  /* или CSS calc для адаптивности */
  }
```

### 6C.2 Критические CSS-свойства

```css
  .dungeon-ascii {
    /* ОБЯЗАТЕЛЬНО: без этих свойств half-blocks не стыкуются */
    line-height: 1;         /* убирает вертикальные зазоры между рядами ▀▄ */
    letter-spacing: 0;      /* убирает горизонтальные зазоры */
    white-space: pre;       /* сохраняет символьные интервалы */

    /* Кристальная чёткость (без антиалиасинга) */
    -webkit-font-smoothing: none;
    -moz-osx-font-smoothing: unset;
    text-rendering: optimizeSpeed;
    font-variant-ligatures: none;  /* отключаем лигатуры! */

    /* Привязка к символьной сетке */
    /* 1ch = ширина одного символа в моноширинном шрифте */
    max-width: calc(min(80ch, round(down, 100%, 1ch)));
  }
```

### 6C.3 Система цветов через CSS-классы

CSS-классы производительнее inline-стилей для покраски отдельных символов.
Определяем палитру и назначаем классы на `<span>` элементы:

```css
  /* Foreground (текст символа) */
  .f0  { color: #000000; }   /* чёрный */
  .f1  { color: #aa0000; }   /* тёмно-красный */
  .f2  { color: #00aa00; }   /* тёмно-зелёный */
  .f3  { color: #aa5500; }   /* коричневый */
  .f4  { color: #0000aa; }   /* тёмно-синий */
  /* ... до f15 для полной ANSI палитры */

  /* Background (фон ячейки) */
  .b0  { background-color: #000000; }
  .b1  { background-color: #aa0000; }
  /* ... до b15 */

  /* Динамические цвета через CSS custom properties */
  .fc { color: var(--fg); }
  .bc { background-color: var(--bg); }
```

```html
  <!-- Пример: стена с факелом -->
  <pre class="dungeon-ascii">
    <span class="f3 b0">████</span><span class="f1 b3">🔥</span><span class="f3 b0">████</span>
  </pre>
```

### 6C.4 Световые эффекты через text-shadow

CSS `text-shadow` создаёт свечение на символах без JavaScript:

```css
  /* Свечение факела на ближайших символах стены */
  .torch-glow-1 { text-shadow: 0 0 8px #f80, 0 0 16px #f60; }
  .torch-glow-2 { text-shadow: 0 0 4px #f80; }
  .torch-glow-3 { text-shadow: 0 0 2px #a50; }

  /* Лунный свет из окна */
  .moonlight    { text-shadow: 0 0 6px #6af; }

  /* Мерцание факела через @keyframes (без JS!) */
  @keyframes torch-flicker {
    0%, 100% { text-shadow: 0 0 8px #f80, 0 0 16px #f60; }
    25%      { text-shadow: 0 0 6px #f70, 0 0 12px #f50; }
    50%      { text-shadow: 0 0 10px #fa0, 0 0 20px #f80; }
    75%      { text-shadow: 0 0 5px #f60, 0 0 10px #f40; }
  }
  .torch-flicker { animation: torch-flicker 0.8s ease-in-out infinite; }
```

### 6C.5 Субпиксельная прокрутка

CSS `transform: translate()` позволяет двигать контейнер с текстом
с точностью до пикселя, пока символы остаются чёткими:

```css
  .dungeon-scroll-container {
    /* Плавная камера при движении по коридору */
    transform: translate(var(--cam-x), var(--cam-y));
    transition: transform 0.15s ease-out;
    will-change: transform;  /* GPU-hint */
  }
```

CSS-трансформы работают на GPU compositor thread, сохраняя 60 FPS
независимо от скорости DOM-рендеринга текста.

---

## 7. ЭФФЕКТЫ И АТМОСФЕРА

### 7.1 Освещение

```
  Источники света:

  🔥 Факелы (уже есть!)
     - Анимированное пламя
     - Динамическое свечение
     - CSS box-shadow + animation

  🌙 Окна
     - Холодный лунный свет
     - radial-gradient голубой

  💡 Свечение вывесок (при hover)
     - text-shadow: 0 0 10px theme
     - Пульсирующий эффект

  🔴 Красное свечение (для alerts)
     - Камни вокруг alert-зоны
       подсвечиваются красным
```

### 7.2 Звуковые эффекты (опционально, отключаемые)

```
  Событие              │ Звук
  ─────────────────────┼──────────────────────
  Hover на дверь       │ Тихий скрип
  Клик по двери        │ Звук открытия двери
  Переход в комнату    │ Шаги по камню
  Hover на книгу       │ Шелест страниц
  Открытие модалки     │ Скрип пергамента
  Сохранение           │ Звон монеты
  Ошибка               │ Глухой удар
```

### 7.3 Overlay-эффекты (сохраняются из текущего UI)

```
  Слой         │ Описание                    │ z-index
  ─────────────┼─────────────────────────────┼─────────
  CRT scanlines│ Горизонтальные полосы        │ 9999
  Vignette     │ Затемнение по краям          │ 9998
  Noise        │ Шум / зернистость            │ 9997
  Flicker      │ Мерцание экрана              │ 9996
```

---

## 8. ИНТЕРАКТИВНЫЕ ЭЛЕМЕНТЫ

### 8.1 Вывески на дверях

```
  Состояние    │ Визуал
  ─────────────┼──────────────────────────────────────
  Default      │ Деревянная табличка, текст выгравирован
               │ Тусклый текст цвета темы
  ─────────────┼──────────────────────────────────────
  Hover        │ Текст ярко светится (glow)
               │ Факелы рядом разгораются
               │ Лёгкое покачивание таблички (rotate)
               │ cursor: pointer
  ─────────────┼──────────────────────────────────────
  Active/Click │ Табличка "нажимается" (scale down)
               │ Запуск анимации входа
  ─────────────┼──────────────────────────────────────
  Disabled     │ Потухшая, потрескавшаяся табличка
  (если нужно) │ Нет hover-эффектов
```

### 8.2 Книги на полках (Энциклопедия)

```
  Состояние    │ Визуал
  ─────────────┼──────────────────────────────────────
  Default      │ Корешок книги виден на полке
               │ Название наклонным текстом
  ─────────────┼──────────────────────────────────────
  Hover        │ Книга выдвигается из полки
               │ (translateX или translateZ)
               │ Появляется tooltip с кратким описанием
  ─────────────┼──────────────────────────────────────
  Click        │ Книга "раскрывается" →
               │ анимация разворота страниц →
               │ модалка с детальной информацией
```

### 8.3 Колбы (Анализы)

```
  Состояние    │ Визуал
  ─────────────┼──────────────────────────────────────
  Default      │ Колба стоит на полке
               │ Жидкость внутри цвета статуса
               │ 🟢 зелёная = норма
               │ 🟡 жёлтая = чуть выше
               │ 🔴 красная = выход за норму
  ─────────────┼──────────────────────────────────────
  Hover        │ Колба "булькает" (CSS animation)
               │ Tooltip с текущим значением
  ─────────────┼──────────────────────────────────────
  Click        │ Выбирает параметр для тренд-графика
```

---

## 9. АДАПТАЦИЯ ПОД МОБИЛЬНЫЕ

```
  Desktop (>1024px):              Mobile (<768px):
  ┌──────────────────┐            ┌───────────┐
  │  Полный 3D зал   │            │  Упрощённый│
  │  с перспективой  │            │  вид:      │
  │                  │            │            │
  │  ┌──┐ ┌──┐ ┌──┐ │            │  ┌────────┐│
  │  │D1│ │D2│ │D3│ │    →→→     │  │ ДВЕРЬ 1││
  │  └──┘ └──┘ └──┘ │            │  └────────┘│
  │                  │            │  ┌────────┐│
  │  Двери по бокам  │            │  │ ДВЕРЬ 2││
  │                  │            │  └────────┘│
  └──────────────────┘            │  ┌────────┐│
                                  │  │ ДВЕРЬ 3││
  3D perspective +                │  └────────┘│
  полные анимации                 │     ...    │
                                  └───────────┘

                                  Вертикальный
                                  скролл дверей,
                                  упрощённые
                                  анимации (fade)
```

---

## 10. ТЕХНИЧЕСКИЙ СТЕК И АРХИТЕКТУРА

### 10.1 Файловая структура (новые/изменённые файлы)

```
  wwwroot/
  ├── css/
  │   ├── dungeon/
  │   │   ├── viewport.css       ← 3D viewport, perspective
  │   │   ├── walls.css          ← Кирпичи, текстуры, дефекты
  │   │   ├── doors.css          ← Двери, вывески, hover-эффекты
  │   │   ├── rooms.css          ← Стили отдельных комнат
  │   │   ├── transitions.css    ← Анимации переходов
  │   │   └── windows.css        ← Окна с решётками, лунный свет
  │   ├── rooms/
  │   │   ├── throne.css         ← Дашборд (тронный зал)
  │   │   ├── lab.css            ← Анализы (лаборатория)
  │   │   ├── alchemy.css        ← Курс (алхимическая)
  │   │   ├── mirrors.css        ← Сравнение (зеркальный зал)
  │   │   ├── arena.css          ← Тренировки (зал с цепями)
  │   │   ├── library.css        ← Энциклопедия (библиотека)
  │   │   └── workshop.css       ← ASCII студия (мастерская)
  │   └── ... (существующие файлы)
  │
  ├── js/
  │   ├── dungeon/
  │   │   ├── dungeonEngine.ts   ← Основной движок подземелья
  │   │   ├── cameraController.ts← Управление камерой и переходами
  │   │   ├── doorInteraction.ts ← Логика взаимодействия с дверями
  │   │   ├── wallGenerator.ts   ← Процедурная генерация стен
  │   │   └── roomManager.ts     ← Управление комнатами (load/unload)
  │   └── ... (существующие файлы)
  │
  └── assets/
      └── dungeon/
          ├── textures/          ← Текстуры (если нужны растровые)
          └── sounds/            ← Звуки (опционально)
```

### 10.2 Ключевые компоненты

```
  ┌─────────────────────────────────────────────────────┐
  │                   DungeonEngine                      │
  │  ┌───────────┐  ┌───────────┐  ┌───────────────┐   │
  │  │  Camera    │  │   Door    │  │    Wall        │   │
  │  │ Controller │  │Interaction│  │  Generator     │   │
  │  │            │  │           │  │                │   │
  │  │ - position │  │ - hover   │  │ - bricks       │   │
  │  │ - animate  │  │ - click   │  │ - cracks       │   │
  │  │ - reset    │  │ - open    │  │ - holes        │   │
  │  │ - lerp     │  │ - close   │  │ - windows      │   │
  │  └─────┬─────┘  └─────┬─────┘  └───────┬───────┘   │
  │        │               │                │            │
  │        └───────┬───────┴────────────────┘            │
  │                │                                     │
  │         ┌──────┴──────┐                              │
  │         │ RoomManager │                              │
  │         │             │                              │
  │         │ - loadRoom  │                              │
  │         │ - unloadRoom│                              │
  │         │ - transition│                              │
  │         └─────────────┘                              │
  └─────────────────────────────────────────────────────┘
```

### 10.3 State Management

```typescript
  DungeonState = {
    currentView: 'hall' | 'room',
    currentRoom: string | null,
    isTransitioning: boolean,
    cameraPosition: { x, y, z },
    doorStates: Map<string, 'open' | 'closed'>,
  }
```

---

## 11. МАППИНГ ТЕКУЩИХ РАЗДЕЛОВ → КОМНАТЫ

```
  Текущий nav-btn   │ Комната              │ Тема интерьера
  ──────────────────┼──────────────────────┼──────────────────
  ДАШБОРД           │ Тронный зал          │ Величественный,
                    │                      │ знамёна, трон
  ──────────────────┼──────────────────────┼──────────────────
  КУРС              │ Алхимическая         │ Котёл, зелья,
                    │                      │ банки на полках
  ──────────────────┼──────────────────────┼──────────────────
  АНАЛИЗЫ           │ Лаборатория          │ Колбы, пергаменты,
                    │ алхимика             │ мел на стенах
  ──────────────────┼──────────────────────┼──────────────────
  СРАВНЕНИЕ         │ Зеркальный зал       │ Два зеркала,
                    │                      │ магические руны
  ──────────────────┼──────────────────────┼──────────────────
  ТРЕНИРОВКИ        │ Зал с цепями         │ Цепи, стойки,
                    │                      │ каменный пол
  ──────────────────┼──────────────────────┼──────────────────
  ЭНЦИКЛОПЕДИЯ      │ Библиотека           │ Стеллажи, книги,
                    │                      │ лестницы
  ──────────────────┼──────────────────────┼──────────────────
  ASCII ART         │ Мастерская           │ Мольберт,
                    │                      │ инструменты
  ──────────────────┼──────────────────────┼──────────────────
  АДМИН             │ Потайная комната     │ За скрытой дверью,
                    │                      │ тёмная, таинственная
```

---

## 12. ПРИОРИТЕТЫ РЕАЛИЗАЦИИ

```
  Фаза 1 (MVP):
  ├── Главный зал с перспективой
  ├── Двери с вывесками
  ├── Базовая анимация перехода (translateZ + fade)
  ├── Кирпичные стены (базовая CSS генерация)
  └── Адаптация текущего контента под "комнаты"

  Фаза 2 (Полировка):
  ├── Процедурные дефекты стен (трещины, дыры)
  ├── Окна с решётками
  ├── Уникальные интерьеры комнат
  ├── Анимация дверей (rotateY)
  └── Улучшенные hover-эффекты

  Фаза 3 (Вау-эффект):
  ├── Звуки
  ├── Интерактивные элементы (книги, колбы)
  ├── Частицы пыли в воздухе
  ├── Мобильная адаптация
  └── Тонкая настройка анимаций
```

---

## 13. CSS-ПЕРЕМЕННЫЕ ДЛЯ ПОДЗЕМЕЛЬЯ

```css
:root {
  /* Шрифт и рендеринг */
  --font-primary: 'JetBrains Mono', 'Fira Code', 'Source Code Pro', monospace;
  --font-size-base: 14px;
  --cell-width: 1ch;           /* ширина одного символа */
  --grid-cols: 80;             /* ячеек по горизонтали */
  --grid-rows: 50;             /* ячеек по вертикали */

  /* Камень */
  --stone-base: #2a2520;
  --stone-light: #3d3630;
  --stone-dark: #1a1510;
  --mortar: #1a1815;

  /* Кирпичи */
  --brick-width: 60px;
  --brick-height: 25px;
  --brick-gap: 3px;
  --brick-radius: 2px;

  /* Дефекты */
  --crack-color: #0a0805;
  --moss-color: #1a3a1a;
  --damp-color: rgba(30, 40, 50, 0.4);

  /* Освещение */
  --torch-glow: radial-gradient(ellipse, rgba(255,150,50,0.15), transparent);
  --moonlight: radial-gradient(ellipse, rgba(100,140,200,0.1), transparent);

  /* Двери */
  --door-wood: #3d2b1a;
  --door-iron: #4a4a50;
  --sign-bg: #2a1f0f;
  --sign-border: #5a4a30;

  /* Анимации */
  --transition-enter: 800ms;
  --transition-door: 400ms;
  --transition-fade: 300ms;
}
```

---

## 14. ВАЖНЫЕ ТЕХНИЧЕСКИЕ РЕШЕНИЯ

**Что НЕ используем и почему:**
- **Three.js / WebGL для 3D:** Слишком тяжело. Three.js AsciiEffect и Shadertoy ASCII
  работают наоборот — рендерят полную 3D-сцену в пикселях и потом
  даунсемплят в символы. Нам нужно наоборот: native текстовый рендеринг
  с CSS perspective (как asciicker, но без WASM).
- **Canvas для стен:** CSS-генерация процедурнее и легче. Canvas только для
  высокочастотных обновлений (миникарта, частицы).
- **Фреймворки (React/Vue):** Остаёмся на vanilla TS как в текущем проекте.
- **rot.js как зависимость:** Хоть это голдстандарт для браузерных roguelike
  (генерация подземелий, FOV, pathfinding), нам не нужен
  полноценный roguelike engine. Но можем заимствовать алгоритмы:
  ROT.Map.Digger для процедурных комнат, ROT.FOV для освещения факелов.

**Что используем:**
- CSS `perspective` + `transform-style: preserve-3d` для pseudo-3D
- CSS `repeating-linear-gradient` для кирпичной кладки
- SVG для трещин и сложных дефектов
- CSS `@keyframes` для анимаций (факелы, мерцание, свечение — без JS!)
- `requestAnimationFrame` для плавных переходов камеры
- `text-shadow` для световых эффектов на символах
- Unicode half-blocks / shade chars / box-drawing / braille для визуала
- AnsiCell буфер + dirty-rectangle для оптимального DOM-обновления
- Intersection Observer для lazy-loading комнат
- Web Audio API для звуков (если включены)

**Совместимость с текущим кодом:**
- Навигация (`initNavigation()`) переписывается на `DungeonEngine`
- Текущие `.page` контейнеры оборачиваются в `.room-content`
- CRT/ASCII overlay эффекты остаются поверх всего
- Текущие модалки работают как есть (поверх комнат)
- Цветовая тема (color picker) продолжает работать → `--theme-color` применяется к glow вывесок

---

## 15. БЕНЧМАРКИ РЕНДЕРИНГА И БЮДЖЕТ ПРОИЗВОДИТЕЛЬНОСТИ

Данные из исследования реальных ASCII-движков (asciicker, rot.js, unicodetiles.js):

```
  Бэкенд          │ FPS (80×50 сетка) │ Применение у нас
  ────────────────┼───────────────────┼──────────────────────
  DOM (<span>)      │ 6–15 FPS (полный  │ Основной рендер.
                  │ редрав)           │ + dirty-rect → 60FPS
  ────────────────┼───────────────────┼──────────────────────
  DOM + textContent│ 30–45 FPS           │ Если 1 цвет на всю
  (единая строка)│                   │ панель (не наш случай)
  ────────────────┼───────────────────┼──────────────────────
  Canvas 2D        │ 60 FPS             │ Миникарта, частицы,
  (fillText)       │                    │ высокочаст. анимации
  ────────────────┼───────────────────┼──────────────────────
  WebGL            │ 60 FPS (тысячи    │ Не используем.
  (атлас шрифта)  │ ячеек)            │ Overkill для нас.
  ────────────────┼───────────────────┼──────────────────────
  CSS transforms   │ 60 FPS (независимо│ Камера, перспектива,
  (композитор)   │ от DOM)            │ переходы, scroll
  ────────────────┼───────────────────┼──────────────────────

  НАШ БЮДЖЕТ:
  - Статичная сцена (стоим в зале): 0 DOM-обновлений + CSS анимации факелов
  - Переход в комнату: CSS transform анимация (GPU) + 1 DOM swap
  - Внутри комнаты: обычный DOM + dirty-rect для динамических элементов
  - Миникарта: Canvas overlay, 15–30 FPS
  - Цель: стабильные 60 FPS на всех переходах
```

---

## 16. ССЫЛОЧНЫЕ БИБЛИОТЕКИ И ИНСТРУМЕНТЫ

Не зависимости, а справочник на случай если понадобится заимствовать алгоритмы:

```
  Библиотека        │ Что даёт                 │ Когда заимствовать
  ─────────────────┼──────────────────────────┼────────────────────────
  rot.js (npm)       │ Dungeon gen, FOV, A*,    │ Алгоритмы освещения
                     │ свет, scheduling        │ факелов (FOV)
  ─────────────────┼──────────────────────────┼────────────────────────
  drawille (npm)     │ Canvas API для braille   │ Миникарта
                     │ canvas.set(x,y)          │ подземелья
  ─────────────────┼──────────────────────────┼────────────────────────
  unicodetiles.js    │ 3 бэкенда (DOM/Canvas/  │ Справочник по
                     │ WebGL), авто-fallback   │ font atlas подходу
  ─────────────────┼──────────────────────────┼────────────────────────
  asciicker (GitHub)  │ Настоящий text-mode 3D │ Вдохновение для
  msokalski/asciicker │ движок (C++/WASM)       │ AnsiCell паттерна
  ─────────────────┼──────────────────────────┼────────────────────────
  3d-game-engine      │ ASCII raycaster          │ Если захотим
  justMoritz/          │ с mouselook, прыжками    │ настоящий FPS view
  ─────────────────┼──────────────────────────┼────────────────────────
```
