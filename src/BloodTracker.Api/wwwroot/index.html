<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BloodTracker</title>
    <meta name="google-client-id" content="118121261230-dtj72qp42r44mgpdbng83a1bju3oj87t.apps.googleusercontent.com">

    <!-- Favicon -->
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml">

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#00ff00">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- CSS bundle (Vite-built from 18 source files) -->
    <link rel="stylesheet" href="dist/css/style.css">
</head>
<body class="crt">
<div class="flicker-overlay"></div>
<div class="vignette-overlay"></div>
<div class="noise-overlay"></div>
<div class="ascii-progress-bar" id="ascii-progress-bar">
    <div class="progress-bar-content">
        <div class="progress-bar-frame">
            <div class="progress-bar-fill" id="progress-bar-fill"></div>
            <div class="progress-bar-text" id="progress-bar-text">0%</div>
        </div>
    </div>
</div>
<div class="torch torch-left">
    <div class="torch-flame-container">
        <div class="torch-flame-ascii">⠀⠀⠀⠀⠀⠀⢱⣆⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠈⣿⣷⡀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢸⣿⣿⣷⣧⠀⠀⠀
⠀⠀⠀⠀⡀⢠⣿⡟⣿⣿⣿⡇⠀⠀
⠀⠀⠀⠀⣳⣼⣿⡏⢸⣿⣿⣿⢀⠀
⠀⠀⠀⣰⣿⣿⡿⠁⢸⣿⣿⡟⣼⡆
⢰⢀⣾⣿⣿⠟⠀⠀⣾⢿⣿⣿⣿⣿
⢸⣿⣿⣿⡏⠀⠀⠀⠃⠸⣿⣿⣿⡿
⢳⣿⣿⣿⠀⠀⠀⠀⠀⠀⢹⣿⡿⡁
⠀⠹⣿⣿⡄⠀⠀⠀⠀⠀⢠⣿⡞⠁
⠀⠀⠈⠛⢿⣄⠀⠀⠀⣠⠞⠋⠀⠀
⠀⠀⠀⠀⠀⠀⠉⠀⠀⠀⠀⠀⠀⠀</div>
    </div>
    <div class="torch-holder-ascii">╔═══════════╗
║  ╔═╗╔═╗  ║
║  ║╬║║╬║  ║
╠══╬═╬═╬══╣
║  ║▓▓▓▓▓║  ║
║  ║▓▓▓▓▓║  ║
║  ║▓▓▓▓▓║  ║
║  ║▓▓▓▓▓║  ║
║  ║▓▓▓▓▓║  ║
╚══╩═╩═╩══╝
   ║═══║
   ║═══║
   ║═══║
   ╚═══╝</div>
</div>
<div class="torch torch-right">
    <div class="torch-flame-container">
        <div class="torch-flame-ascii">⠀⠀⠀⠀⠀⠀⢱⣆⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠈⣿⣷⡀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢸⣿⣿⣷⣧⠀⠀⠀
⠀⠀⠀⠀⡀⢠⣿⡟⣿⣿⣿⡇⠀⠀
⠀⠀⠀⠀⣳⣼⣿⡏⢸⣿⣿⣿⢀⠀
⠀⠀⠀⣰⣿⣿⡿⠁⢸⣿⣿⡟⣼⡆
⢰⢀⣾⣿⣿⠟⠀⠀⣾⢿⣿⣿⣿⣿
⢸⣿⣿⣿⡏⠀⠀⠀⠃⠸⣿⣿⣿⡿
⢳⣿⣿⣿⠀⠀⠀⠀⠀⠀⢹⣿⡿⡁
⠀⠹⣿⣿⡄⠀⠀⠀⠀⠀⢠⣿⡞⠁
⠀⠀⠈⠛⢿⣄⠀⠀⠀⣠⠞⠋⠀⠀
⠀⠀⠀⠀⠀⠀⠉⠀⠀⠀⠀⠀⠀⠀</div>
    </div>
    <div class="torch-holder-ascii">╔═══════════╗
║  ╔═╗╔═╗  ║
║  ║╬║║╬║  ║
╠══╬═╬═╬══╣
║  ║▓▓▓▓▓║  ║
║  ║▓▓▓▓▓║  ║
║  ║▓▓▓▓▓║  ║
║  ║▓▓▓▓▓║  ║
║  ║▓▓▓▓▓║  ║
╚══╩═╩═╩══╝
   ║═══║
   ║═══║
   ║═══║
   ╚═══╝</div>
</div>
<!-- TOXIC MACHINE logo — raw ASCII art (backslashes break in JSX, stored here) -->
<script id="toxic-machine-tpl" type="text/template">______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
_________/\\\\\\\\\\\\\\\_______/\\\\\_______/\\\_______/\\\__/\\\\\\\\\\\________/\\\\\\\\\____________/\\\\____________/\\\\_____/\\\\\\\\\___________/\\\\\\\\\__/\\\________/\\\__/\\\\\\\\\\\__/\\\\\_____/\\\__/\\\\\\\\\\\\\\\________
________\///////\\\/////______/\\\///\\\____\///\\\___/\\\/__\/////\\\///______/\\\////////____________\/\\\\\\________/\\\\\\___/\\\\\\\\\\\\\______/\\\////////__\/\\\_______\/\\\_\/////\\\///__\/\\\\\\___\/\\\_\/\\\///////////_________
______________\/\\\_________/\\\/__\///\\\____\///\\\\\\/________\/\\\_______/\\\/_____________________\/\\\//\\\____/\\\//\\\__/\\\/////////\\\___/\\\/___________\/\\\_______\/\\\_____\/\\\_____\/\\\/\\\__\/\\\_\/\\\____________________
______________\/\\\________/\\\______\//\\\_____\//\\\\__________\/\\\______/\\\_______________________\/\\\\///\\\/\\\/_\/\\\_\/\\\_______\/\\\__/\\\_____________\/\\\\\\\\\\\\\\\_____\/\\\_____\/\\\//\\\_\/\\\_\/\\\\\\\\\\\____________
______________\/\\\_______\/\\\_______\/\\\______\/\\\\__________\/\\\_____\/\\\_______________________\/\\\__\///\\\/___\/\\\_\/\\\\\\\\\\\\\\\_\/\\\_____________\/\\\/////////\\\_____\/\\\_____\/\\\\//\\\\/\\\_\/\\\///////_____________
______________\/\\\_______\//\\\______/\\\_______/\\\\\\_________\/\\\_____\//\\\______________________\/\\\____\///_____\/\\\_\/\\\/////////\\\_\//\\\____________\/\\\_______\/\\\_____\/\\\_____\/\\\_\//\\\/\\\_\/\\\____________________
______________\/\\\________\///\\\__/\\\_______/\\\////\\\_______\/\\\______\///\\\____________________\/\\\_____________\/\\\_\/\\\_______\/\\\__\///\\\__________\/\\\_______\/\\\_____\/\\\_____\/\\\__\//\\\\\\_\/\\\____________________
______________\/\\\__________\///\\\\\/______/\\\/___\///\\\__/\\\\\\\\\\\____\////\\\\\\\\\___________\/\\\_____________\/\\\_\/\\\_______\/\\\____\////\\\\\\\\\_\/\\\_______\/\\\__/\\\\\\\\\\\_\/\\\___\//\\\\\_\/\\\\\\\\\\\\\\\________
______________\///_____________\/////_______\///_______\///__\///////////________\/////////____________\///______________\///__\///________\///________\/////////__\///________\///__\///////////__\///_____\/////__\///////////////_________
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________</script>

<!-- Skull strip — outside React tree to avoid reconciliation conflicts -->
<div id="ascii-skeleton-strip"></div>

<!-- React root — App.tsx renders Navigation, Pages, Modals, etc. -->
<div id="app"></div>

<!-- Color Picker (vanilla JS — window.toggleColorPicker, setColor, setFont) -->
<div class="color-picker-container">
    <button class="color-picker-toggle" onclick="toggleColorPicker()">[ ЦВЕТ ]</button>
    <div class="color-picker-panel" id="color-picker-panel">
        <div class="color-presets">
            <div class="color-preset" style="background: #00ff00;" onclick="setColor('#00ff00')" title="Зеленый"></div>
            <div class="color-preset" style="background: #00ffff;" onclick="setColor('#00ffff')" title="Голубой"></div>
            <div class="color-preset" style="background: #ff00ff;" onclick="setColor('#ff00ff')" title="Пурпурный"></div>
            <div class="color-preset" style="background: #ffff00;" onclick="setColor('#ffff00')" title="Желтый"></div>
            <div class="color-preset" style="background: #ff6600;" onclick="setColor('#ff6600')" title="Оранжевый"></div>
            <div class="color-preset" style="background: #ff0066;" onclick="setColor('#ff0066')" title="Розовый"></div>
            <div class="color-preset" style="background: #00ff66;" onclick="setColor('#00ff66')" title="Лайм"></div>
            <div class="color-preset" style="background: #6600ff;" onclick="setColor('#6600ff')" title="Фиолетовый"></div>
        </div>
        <div class="color-custom">
            <input type="color" id="custom-color" value="#00ff00" onchange="setColor(this.value)">
            <input type="text" id="custom-color-text" value="#00ff00" placeholder="#00ff00" onchange="setColor(this.value)">
        </div>
        <div class="font-picker" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border);">
            <div style="margin-bottom: 10px; font-size: 12px; color: var(--text-secondary);">ШРИФТ:</div>
            <div style="display: flex; gap: 8px;">
                <button class="font-preset" onclick="setFont('rotasuningr')" style="flex: 1; padding: 8px; background: transparent; border: 1px solid var(--border); color: var(--text-primary); cursor: pointer; font-family: var(--ascii-font-family);">Rotasuningr</button>
                <button class="font-preset" onclick="setFont('ibm')" style="flex: 1; padding: 8px; background: transparent; border: 1px solid var(--border); color: var(--text-primary); cursor: pointer; font-family: var(--ascii-font-family);">IBM MDA</button>
            </div>
        </div>
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border);">
            <div style="margin-bottom: 10px; font-size: 12px; color: var(--text-secondary);">ASCII ЗАГОЛОВКИ:</div>
            <button id="asciify-toggle-btn" class="asciify-toggle active" onclick="window.asciify.toggle()">[ ASCII: ON ]</button>
        </div>
    </div>
</div>

<!-- Anti-reload-loop guard. Runs BEFORE any ES6 modules load. -->
<!-- Detects rapid reloads (401 → reload → 401 loop) and breaks the cycle. -->
<script>
(function() {
    var key = '_bt_rl', now = Date.now();
    var last = parseInt(sessionStorage.getItem(key) || '0');
    if (now - last < 3000) {
        localStorage.removeItem('bt_token');
        localStorage.removeItem('bt_user');
        sessionStorage.removeItem(key);
        return;
    }
    sessionStorage.setItem(key, String(now));
    setTimeout(function() { sessionStorage.removeItem(key); }, 5000);
})();
</script>

<!-- Google Sign-In -->
<script>
    window.initGoogleSignIn = function() {
        const clientId = document.querySelector('meta[name="google-client-id"]')?.content;
        if (clientId && window.google?.accounts?.id) {
            google.accounts.id.initialize({
                client_id: clientId,
                callback: window.handleGoogleCredential
            });
        }
    };
</script>
<script src="https://accounts.google.com/gsi/client" async defer onload="initGoogleSignIn()"></script>

<script src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.1/dist/apexcharts.min.js"></script>

<!-- JavaScript Module -->
<script type="module" src="dist/js/main.js"></script>
</body>
</html>
